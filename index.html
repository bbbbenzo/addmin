<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –±–æ—Ç–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .nav-bottom {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .tab-content {
            margin-bottom: 70px;
            padding: 20px;
        }
        .metric-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-3px);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content">
            <!-- –ì–ª–∞–≤–Ω–∞—è -->
            <div class="tab-pane active" id="home">
                <h4 class="mb-4"><i class="fas fa-home"></i> –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏</h4>
                <div class="row">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h5>üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
                            <h2 class="text-primary">{{ total_users }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h5>‚≠ê –û—Ü–µ–Ω–æ–∫ —Å–µ–≥–æ–¥–Ω—è</h5>
                            <h2 class="text-success">{{ today_ratings }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h5>üíé –ü—Ä–µ–º–∏—É–º</h5>
                            <h2 class="text-warning">{{ premium_users }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h5>üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h5>
                            <h2 class="text-info">{{ activity_percent }}%</h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="tab-pane" id="stats">
                <h4 class="mb-4"><i class="fas fa-chart-line"></i> –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                <div class="metric-card">
                    <h5>üìä –ì—Ä–∞—Ñ–∏–∫ –æ—Ü–µ–Ω–æ–∫</h5>
                    <canvas id="ratingsChart" style="height: 300px;"></canvas>
                </div>
            </div>

            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div class="tab-pane" id="users">
                <h4 class="mb-4"><i class="fas fa-users"></i> –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h4>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="searchUsers" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
                </div>
                <div class="list-group" id="userList">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ AJAX -->
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="tab-pane" id="settings">
                <h4 class="mb-4"><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
                <div class="metric-card">
                    <h5>üîó –°—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã</h5>
                    <div class="mb-3">
                        <label>–ü–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª</label>
                        <input type="text" class="form-control" id="firstChannel" value="https://t.me/channel1">
                    </div>
                    <div class="mb-3">
                        <label>–í—Ç–æ—Ä–æ–π –∫–∞–Ω–∞–ª</label>
                        <input type="text" class="form-control" id="secondChannel" value="https://t.me/channel2">
                    </div>
                    <button class="btn btn-primary" onclick="updateChannels()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
        <nav class="nav nav-pills nav-bottom justify-content-around">
            <a class="nav-link active" data-bs-toggle="tab" href="#home">
                <i class="fas fa-home"></i><br>
                –ì–ª–∞–≤–Ω–∞—è
            </a>
            <a class="nav-link" data-bs-toggle="tab" href="#stats">
                <i class="fas fa-chart-line"></i><br>
                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </a>
            <a class="nav-link" data-bs-toggle="tab" href="#users">
                <i class="fas fa-users"></i><br>
                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            </a>
            <a class="nav-link" data-bs-toggle="tab" href="#settings">
                <i class="fas fa-cog"></i><br>
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </a>
        </nav>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
        $(document).ready(function(){
            $('.nav-link').click(function(){
                $('.nav-link').removeClass('active');
                $(this).addClass('active');
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            loadChart();
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            loadUsers();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
        function loadChart() {
            fetch('/get_stats')
                .then(response => response.json())
                .then(data => {
                    const ctx = document.getElementById('ratingsChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.labels,
                            datasets: [{
                                label: '–û—Ü–µ–Ω–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π',
                                data: data.values,
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function loadUsers() {
            fetch('/get_users')
                .then(response => response.json())
                .then(data => {
                    const userList = document.getElementById('userList');
                    userList.innerHTML = '';
                    data.forEach(user => {
                        userList.innerHTML += `
                            <a href="#" class="list-group-item list-group-item-action">
                                ID: ${user.id} (–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${user.timestamp})
                            </a>
                        `;
                    });
                });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∫–∞–Ω–∞–ª—ã
        function updateChannels() {
            const firstChannel = document.getElementById('firstChannel').value;
            const secondChannel = document.getElementById('secondChannel').value;

            fetch('/update_channels', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    first_channel: firstChannel,
                    second_channel: secondChannel
                })
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'success') {
                      alert('–°—Å—ã–ª–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
                  }
              });
        }
    </script>
</body>
</html>
